    
    
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    
<style>
html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}a{background-color:transparent}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}*,:after,:before{box-sizing:inherit}html{box-sizing:border-box;font-size:62.5%}body{color:#606c76;font-family:Roboto,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:1.6em;font-weight:300;letter-spacing:.01em;line-height:1.6}hr{border-top:.1rem solid #f4f5f6}.container{margin:0 auto;max-width:112rem;padding:0 2rem;position:relative;width:100%}a{color:#9b4dca}p{margin-bottom:2.5rem}h1,p{margin-top:0}h1{font-weight:300;letter-spacing:-.1rem;margin-bottom:2rem}h1{font-size:4.6rem;line-height:1.2}html{min-height:100%;position:relative;-moz-text-size-adjust:none;-webkit-text-size-adjust:none;text-size-adjust:none;touch-action:manipulation}body,html{background-color:#fff}body{font:19px/1.6 Open Sans,Ubuntu,Nimbus Sans L,Avenir,AvenirNext,Segoe UI,Helvetica,Arial,sans-serif;color:#222}h1{page-break-after:avoid;page-break-inside:avoid}hr{border:0;border-top:.1rem solid #c62129;margin:3rem 0}a{color:#0070be;border-bottom:.08em solid rgba(0,0,0,.1);padding-bottom:.08em}a{text-decoration:none}main{-webkit-animation:fade-in 1s ease;animation:fade-in 1s ease}@-webkit-keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes fade-in{0%{opacity:0}to{opacity:1}}header{text-align:center;margin-bottom:15px}.post header h1 a{color:#222;text-decoration:none;border-bottom:0}.post p:first-child:first-letter{float:left;font-family:Georgia;font-size:71px;line-height:50px;padding-top:5px;padding-right:8px}.ns-main{max-width:750px;padding:0 1.5em;margin:3% auto}.ns-post-summary{color:#000}.ns-readmore{margin-bottom:2.2em}.ns-tags,time{color:#626262;font-size:.85em}.pie{background:#000;border-radius:50%;box-shadow:0 0 4px 5px rgba(0,0,0,.2);height:400px;left:-200px;position:absolute;top:-200px;width:400px;transform:translateX(-200px)translateY(-200px);z-index:1}.pie1{-webkit-clip-path:polygon(200px 200px,344px 450px,0 450px);clip-path:polygon(200px 200px,344px 450px,0 450px)}.pie2{-webkit-clip-path:polygon(200px 200px,344px 450px,450px 344px);clip-path:polygon(200px 200px,344px 450px,450px 344px)}.pie3{-webkit-clip-path:polygon(200px 200px,450px 0,450px 344px);clip-path:polygon(200px 200px,450px 0,450px 344px)}.pie-color{width:100%;height:100%;border-radius:50%}.pie-color-hyperlink{font-size:1.7rem;letter-spacing:.05em;font-weight:700;color:#fff}.pie-color1{background:linear-gradient(135deg,#c62129,#c62129);-webkit-clip-path:polygon(200px 200px,344px 450px,0 450px);clip-path:polygon(200px 200px,344px 450px,0 450px)}.pie-color2{background:linear-gradient(135deg,#fff,#fff);-webkit-clip-path:polygon(200px 200px,344px 450px,450px 344px);clip-path:polygon(200px 200px,344px 450px,450px 344px)}.pie-color3{background:linear-gradient(135deg,#c62129,#c62129);-webkit-clip-path:polygon(200px 200px,450px 0,450px 344px);clip-path:polygon(200px 200px,450px 0,450px 344px)}.linkedin{left:208px;position:absolute;top:320px}.twitter{left:282px;top:279px}.rss,.twitter{position:absolute;width:46px}.rss{left:324px;top:210px}.menu{background:#fff;border-radius:50%;box-shadow:0 0 4px 5px rgba(0,0,0,.2);height:200px;left:-100px;position:absolute;top:-100px;width:200px;z-index:1}.hamburger{height:46px;left:58%;position:relative;top:58%;width:46px}.hamburger path:first-child{transform-origin:25% 29%}.hamburger path:nth-child(2){transform-origin:50% 50%}.hamburger path:nth-child(3){transform-origin:75% 72%}.hamburger path:nth-child(4){transform-origin:75% 29%}.hamburger path:nth-child(5){transform-origin:25% 72%}.hero-image{background-image:linear-gradient(rgba(0,0,0,.5),rgba(0,0,0,.5)),url(/img/BandHeader.jpg?v=fingerprint)}.hero-image{min-height:280px;height:50%;box-shadow:-5px 24px 65px -31px rgba(0,0,0,.75);background-position:50%;background-repeat:no-repeat;background-size:cover;position:relative}.hero-text{text-align:center;color:#fff;position:absolute;top:50%;left:50%;background-color:rgba(0,0,0,.5);padding:10px;margin-top:10px;margin-bottom:10px;border-radius:10px;transform:translate(-50%,-50%)}@media (min-width:1367px){.hero-text{width:40%}}@media (min-width:1024px) and (max-width:1366px) and (orientation:portrait){.hero-text{width:80%}}@media (min-width:1024px) and (max-width:1366px) and (orientation:landscape){.hero-text{width:40%}}.hero-text a{color:#fff}.hero-text a,.hero-text a :visited{border-bottom:0}.ns-tagline{padding-top:25px;padding-left:15px;padding-right:15px}.ns-social,.ns-tagline{margin:auto;max-width:800px;position:relative;text-align:center}
</style>


    <title>Schoolbase to create and populate AD groups</title>
    <meta
      name="Keywords"
      content="Technology, IT, Education, Software, Security"
    />
    <meta
      name="Description"
      content="Head of Information Services, Web Technologist &amp;amp; Musician, based on the Wiltshire, Dorset &amp; Somerset border in the UK.  Offering honest independent advice on all things web, security and general IT; with a splash of added music for the soul."
    />

    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1"
    />
    <meta name="robots" content="index,follow" />
    <meta name="Author" content="normansolutions.co.uk" />
    <meta name="language" content="EN" />
    <meta name="Classification" content="" />
    <meta
      name="copyright"
      content="Copyright (c) 2020 'normansolutions.co.uk' All rights reserved."
    />
    <meta name="revisit-after" content="7 days" />
    <meta name="document-classification" content="Technology" />
    <meta name="document-type" content="Public" />
    <meta name="document-rating" content="Safe for Kids" />
    <meta name="document-distribution" content="Global" />
    <link rel="me" type="text/html" href="https://twitter.com/normansolutions" />
    <link
      type="application/rsd+xml"
      rel="edituri"
      title="RSD"
      href="robots.txt"
    />
    <link rel="canonical" href="https://normansolutions.co.uk" />
    <meta name="application-name" content="Normansolutions" />
    <meta name="msapplication-TileColor" content="#ffffff" />

    <meta property="og:title" content="NS News and Views" />
    <meta property="og:type" content=article />   
    <meta
      property="og:description"
      content="Head of Information Services, Web Technologist &amp;amp; Musician, based on the Wiltshire, Dorset &amp; Somerset border in the UK.  Offering honest independent advice on all things web, security and general IT; with a splash of added music for the soul."
    />
    <meta
      property="og:image"
      content="https://normansolutions.co.uk/appicons/Icon-568.jpg"
    />
    <meta property="og:url" content="https://normansolutions.co.uk" />
    <meta property=og:description content="Head of Information Services, Web Technologist &amp;amp; Musician, based on the Wiltshire, Dorset &amp; Somerset border in the UK.  Offering honest independent advice on all things web, security and general IT; with a splash of added music for the soul.">

    <meta name="twitter:title" content="NS News and Views" />
    <meta
      name="twitter:description"
      content="Head of Information Services, Web Technologist &amp;amp; Musician, based on the Wiltshire, Dorset &amp; Somerset border in the UK.  Offering honest independent advice on all things web, security and general IT; with a splash of added music for the soul."    />
    <meta name="twitter:image" content="/appicons/Icon-568.jpg" />
    <meta name="twitter:card" content="summary_large_image" />
    <link rel="manifest" href="/manifest.json" />

    















<link
  rel="preload"
  href="/css/main.min.3a011034e0bb3c1ec67ba875b88b0d22f9364c24583ce189683cfe62180fb36d.css?v=ns-fingerprint"
  integrity="sha256-OgEQNOC7PB7Ge6h1uIsNIvk2TCRYPOGJaDz&#43;YhgPs20="
  as="style"
  crossorigin="anonymous"
/>
<link
  rel="stylesheet"
  href="/css/main.min.3a011034e0bb3c1ec67ba875b88b0d22f9364c24583ce189683cfe62180fb36d.css?v=ns-fingerprint"
  integrity="sha256-OgEQNOC7PB7Ge6h1uIsNIvk2TCRYPOGJaDz&#43;YhgPs20="
  media="print"
  onload="this.media='all'"
  crossorigin="anonymous"
/>

    

    
    <script>
      !(function (document) {
        "use strict";
        var webpImage,
          avifImage =
            "data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAF0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgS0AAAAAABNjb2xybmNseAACAAIAAIAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAGVtZGF0EgAKBzgAPtAgIAkyUBAAAPWc41TP///4gHBX9H8XVK7gGeDllq8TYARA+8Tfsv7L+zPE24eIoIzE0WhHbrqcrTK9VEgEG/hwgB5rdCbvP8g3KYPdV88CvPJnptgQ",
          webpClass = "webp",
          avifClass = "avif";
        function alreadyTested(format) {
          if (window.sessionStorage) {
            var test = window.sessionStorage.getItem(format + "Support");
            if ("false" === test || "true" === test) return "true" === test;
          }
          return null;
        }
        function testFormat(format, imageSrc, callback) {
          var tested = alreadyTested(format);
          if (null === tested) {
            var image = new Image();
            return (
              (image.onload = image.onerror = function () {
                callback(format, 2 === image.height);
              }),
              void (image.src = imageSrc)
            );
          }
          addClass(format, tested);
        }
        function addClass(format, support) {
          if (support) {
            var el = document.documentElement;
            el.classList
              ? el.classList.add("webp" === format ? "webp" : "avif")
              : (el.className += " " + format == "webp" ? "webp" : "avif"),
              window.sessionStorage.setItem(format + "Support", !0);
          } else window.sessionStorage.setItem(format + "Support", !1);
        }
        testFormat(
          "webp",
          "data:image/webp;base64,UklGRi4AAABXRUJQVlA4TCEAAAAvAUAAEB8wAiMwAgSSNtse/cXjxyCCmrYNWPwmHRH9jwMA",
          addClass
        ),
          testFormat("avif", avifImage, addClass);
      })(document);
    </script>

    <script src="https://polyfill.io/v2/polyfill.min.js?features=IntersectionObserver"></script>
  </head>
  <body itemscope itemtype=http://schema.org/WebPage></body>
</html>

    <div class="pie pie1" onclick="document.body.classList.remove('active')">
  <a href="https://www.linkedin.com/in/normansolutions" target="_blank">
    <div class="pie-color pie-color1">
      <span class="pie-color-hyperlink linkedin">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="46"
          height="46"
          viewBox="0 0 24 24"
        >
          <path
            d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
          /></svg
      ></span>
    </div>
  </a>
</div>
<div class="pie pie2" onclick="document.body.classList.remove('active')">
  <a href="https://twitter.com/normansolutions" target="_blank">
    <div class="pie-color pie-color2">
      <span class="pie-color-hyperlink twitter">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="46"
          height="46"
          viewBox="0 0 24 24"
        >
          <path
            d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"
          />
        </svg>
      </span>
    </div>
  </a>
</div>
<div class="pie pie3" onclick="document.body.classList.remove('active')">
  <a href="/index.xml">
    <div class="pie-color pie-color3">
      <span class="pie-color-hyperlink rss">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="46"
          height="46"
          viewBox="0 0 24 24"
        >
          <path
            d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"
          />
        </svg>
      </span>
    </div>
  </a>
</div>
<div class="menu" onclick="document.body.classList.toggle('active')">
  <svg
    class="hamburger"
    xmlns="http://www.w3.org/2000/svg"
    width="100"
    height="100"
    viewBox="0 0 100 100"
  >
    <g fill="none" stroke="#000" stroke-width="7.999" stroke-linecap="round">
      <path d="M 55,26.000284 L 24.056276,25.999716" />
      <path d="M 24.056276,49.999716 L 75.943724,50.000284" />
      <path d="M 45,73.999716 L 75.943724,74.000284" />
      <path d="M 75.943724,26.000284 L 45,25.999716" />
      <path d="M 24.056276,73.999716 L 55,74.000284" />
    </g>
  </svg>
</div>

    <div class="hero-image">
  <div class="hero-text">
    <h1><a href="\">NS News &amp; Views</a></h1>
    <div class="ns-tagline">By Clive Norman</div>
    
    <a class="ns-list-articles" href="/?post=allposts">List all 32 articles</a>
    
  </div>
</div>

<div class="ns-social">
  <a target="_blank" href="https://www.linkedin.com/in/normansolutions">
    
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="64"
      height="64"
      viewBox="0 0 64 64"
    >
      <ellipse cy="32" cx="32" ry="32" rx="32" fill="#ffffff"></ellipse>
      <path
        id="path1"
        transform="rotate(0,32,32) translate(14.1963130235672,14) scale(1.450,1.450)  "
        fill="#C62129"
        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
      />
    </svg>
  </a>
  <a target="_blank" href="https://twitter.com/normansolutions">
    
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="64"
      height="64"
      viewBox="0 0 64 64"
    >
      <ellipse cy="32" cx="32" ry="32" rx="32" fill="#ffffff"></ellipse>
      <path
        id="path1"
        transform="rotate(0,32,32) translate(14.1963130235672,14) scale(1.450,1.450)  "
        fill="#C62129"
        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-.139 9.237c.209 4.617-3.234 9.765-9.33 9.765-1.854 0-3.579-.543-5.032-1.475 1.742.205 3.48-.278 4.86-1.359-1.437-.027-2.649-.976-3.066-2.28.515.098 1.021.069 1.482-.056-1.579-.317-2.668-1.739-2.633-3.26.442.246.949.394 1.486.411-1.461-.977-1.875-2.907-1.016-4.383 1.619 1.986 4.038 3.293 6.766 3.43-.479-2.053 1.08-4.03 3.199-4.03.943 0 1.797.398 2.395 1.037.748-.147 1.451-.42 2.086-.796-.246.767-.766 1.41-1.443 1.816.664-.08 1.297-.256 1.885-.517-.439.656-.996 1.234-1.639 1.697z"
      />
    </svg>
  </a>

  <a target="_blank" href="/index.xml">
    
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="64"
      height="64"
      viewBox="0 0 64 64"
    >
      <ellipse cy="32" cx="32" ry="32" rx="32" fill="#ffffff"></ellipse>
      <path
        id="path1"
        transform="rotate(0,32,32) translate(14.1963130235672,14) scale(1.450,1.450)  "
        fill="#C62129"
        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-12.832 20c-1.197 0-2.168-.969-2.168-2.165s.971-2.165 2.168-2.165 2.167.969 2.167 2.165-.97 2.165-2.167 2.165zm5.18 0c-.041-4.029-3.314-7.298-7.348-7.339v-3.207c5.814.041 10.518 4.739 10.561 10.546h-3.213zm5.441 0c-.021-7.063-5.736-12.761-12.789-12.792v-3.208c8.83.031 15.98 7.179 16 16h-3.211z"
      />
    </svg>
  </a>
</div>

    
    
<main itemprop="mainEntity" itemscope="" itemtype="http://schema.org/Blog" class="ns-main"> 
  <h1>Schoolbase to create and populate AD groups</h1>
  <div class="ns-postdate">  
      <time datetime=2014-01-22&#32;11:52:12&#32;&#43;0000&#32;UTC itemprop="datePublished">Published Wednesday, Jan 22, 2014</time>
      <span class="ns-tags">| Tags: <a href="/tags/schoolbase">Schoolbase</a> <a href="/tags/mis">MIS</a> <a href="/tags/c">C#</a> <a href="/tags/sysadmin">SysAdmin</a> <a href="/tags/devops">Devops</a> </span>   
      <hr/>
    </div>
    <div id="ns-target">
      <p>At St Mary’s we use <a href="http://www.furlongsolutions.com/products/schoolbase">Schoolbase</a> from Furlong Solutions, for our <a href="http://en.wikipedia.org/wiki/Management_information_systems">MIS</a> - we have done so for several years <em>(indeed my understanding is that we were the second or third official school to have the system in production).</em></p>
<p>We have had, and continue to have, an excellent and honest relationship with Furlong.  From my experience, I cannot speak highly enough of their commitment, flexibility and moral approach to supporting schools.  Of the many MIS companies that I have been involved with in recent years <em>(one way or another),</em> Furlong often exceed expectation, when faced with a desperate requirement for a quick solution turnaround <em>(very</em> <a href="http://en.wikipedia.org/wiki/Agile_software_development"><em>Agile</em></a> <em>like).</em></p>
<blockquote>
<p><em>For blog integrity, I should register that <a href="http://en.wiktionary.org/wiki/IMHO">IMHO</a>, there are some aspects of Schoolbase which alas, impress me less (primarily concerning <a href="http://en.wikipedia.org/wiki/User_experience">UX</a> / <a href="http://en.wikipedia.org/wiki/User_interface">UI</a>) – this should however, not reduce any of the aforementioned compliments; the dream is that Furlong will someday employ a team of experienced professional UX designers - you could then have one exceptional product, backed by one exceptional company!</em></p>
</blockquote>
<h2 id="so-ad-groups-from-schoolbase">So, AD groups from Schoolbase?</h2>
<p>Like most enterprise environments, we use <a href="http://en.wikipedia.org/wiki/Active_Directory">Active Directory</a> groups extensively for managing security permissions on resources <em>(printers / folder etc).</em></p>
<p>To manually create these groups in AD, when they <em>already</em> exist in Schoolbase, does feel very inefficient; an ideal candidate for the <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a> <em>(do not repeat)</em> principle?  Agreed it’s <em>not</em> specifically a software concern, but it is <em>still</em> a repetition process – and always <em>potentially</em> dangerous!</p>


<img
src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="
data-src="/img/postimg/b9cc4743-d4d1-489e-b2d4-df224189ffa0-min.jpg"/>


<h6 id="_picture-credit_-_httpdeviqcommost-popular-principlesdon-t-repeat-yourself_httpdeviqcommost-popular-principlesdon-t-repeat-yourself-httpdeviqcommost-popular-principlesdon-t-repeat-yourself__"><em>(picture credit:</em> <a href="http://deviq.com/most-popular-principles/don-t-repeat-yourself" title="http://deviq.com/most-popular-principles/don-t-repeat-yourself"><em>http://deviq.com/most-popular-principles/don-t-repeat-yourself</em></a><em>)</em></h6>
<p>I enjoy writing small utilities that serve specific purposes - I tend to do this in <a href="http://en.wikipedia.org/wiki/C_Sharp_(programming_language)">C#</a> nowadays.</p>
<p>One such utility, is the ability to enumerate through group information held in Schoolbase, creating and populating Active Directory groups appropriately.  This maintains consistent synchronisation between the two systems – ensuring Schoolbase remains the prime point of entry <em>(the <a href="http://www.oracle.com/index.html">Oracle</a>, so to speak – Geek joke - pun intended!)</em> thus reducing the chance of users being granted incorrect AD permissions to resources.</p>
<p>We previously managed this with an array of <a href="http://en.wikipedia.org/wiki/VBScript">VBScripts</a> – the C# solution is much more efficient!</p>
<hr>
<h2 id="the-solution">The solution!</h2>
<p>Luckily, we are able use an <em>existing</em> Schoolbase <a href="http://en.wikipedia.org/wiki/View_(SQL)">SQL View</a> to gather all appropriate group information from the Schoolbase database – this view is called “<strong>GroupRep</strong>”.</p>
<p>We connect this sql view to a <a href="http://msdn.microsoft.com/en-us/library/0wc2kk78(v=vs.90).aspx">C# Console Application</a>.  I recommend a console application, primarily because it can be triggered from a <a href="http://en.wikipedia.org/wiki/Batch_file">batch file</a> running in <a href="http://en.wikipedia.org/wiki/Windows_Task_Scheduler">task scheduler</a> etc.</p>
<p>The workflow of this program is detailed below, followed by the actual code itself.</p>
<blockquote>
<p><em><strong>If viewing code is not your thing</strong>, please feel free to <a href="#jumpToStandAlone">jump straight to the section below the code</a>, which contains a link to the compiled standalone executable, a database connection configuration file and an example batch file for triggering the whole thing!</em></p>
</blockquote>
<h2 id="the-workflow">The workflow</h2>
<ul>
<li>We use <a href="http://msdn.microsoft.com/en-us/library/bb425822.aspx">Linq to SQL</a> to connect to the “GroupRep” view, passing in query filters - <em>from the batch file</em> - in order to <em>only</em> select those groups matching specific subject name(s) etc.</li>
<li>We then enumerate through the data result, where necessary, <em>removing</em> existing members from any Schoolbase named AD group, in the specific OU – this will <strong>only</strong> remove group membership from these groups in this OU – it will not touch any other AD groups.</li>
<li>We then use this same enumeration process to create new AD Groups based on the Schoolbase group name <em>(where they do not exist already).</em></li>
<li>Finally we populate / re-populate these Schoolbase AD groups, with appropriate students - based on the Schoolbase student <strong>ADS Username</strong> field.</li>
</ul>
<hr>
<blockquote>
<p><em>It’s worth noting that there are numerous optimisations within the code, designed to prevent repetitive and unnecessary tasks.</em></p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">namespace</span> CreateADGroups
{
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Program</span>
    {
        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Main(<span style="color:#66d9ef">string</span>[] args)
        {
            <span style="color:#66d9ef">string</span> activeDirPath = args[<span style="color:#ae81ff">0</span>];
            <span style="color:#66d9ef">string</span> activeDirOU = args[<span style="color:#ae81ff">1</span>];
            <span style="color:#66d9ef">string</span> usersLocation = args[<span style="color:#ae81ff">2</span>];
            <span style="color:#66d9ef">string</span> filterIn = args[<span style="color:#ae81ff">3</span>];
            <span style="color:#66d9ef">string</span> filterOut = args[<span style="color:#ae81ff">4</span>];

            <span style="color:#66d9ef">var</span> DBConnString = System.Configuration.ConfigurationManager.ConnectionStrings[<span style="color:#e6db74">&#34;CreateADGroups.Properties.Settings.SchoolbaseConnectionString&#34;</span>].ToString();
            GetGroupDataDataContext GroupData = <span style="color:#66d9ef">new</span> GetGroupDataDataContext(DBConnString);
            List&lt;<span style="color:#66d9ef">string</span>&gt; groupNameIncludeFilter = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt; { };
            List&lt;<span style="color:#66d9ef">string</span>&gt; groupNameExcludeFilter = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt; { };
            List&lt;<span style="color:#66d9ef">string</span>&gt; groupBeenChecked = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt; { };

            <span style="color:#66d9ef">string</span>[] filterInLoop = filterIn.Split(<span style="color:#e6db74">&#39;|&#39;</span>);
            <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">string</span> filterInWord <span style="color:#66d9ef">in</span> filterInLoop)
            {
                groupNameIncludeFilter.Add(filterInWord);
            }

            <span style="color:#66d9ef">string</span>[] filterOutLoop = filterOut.Split(<span style="color:#e6db74">&#39;|&#39;</span>);
            <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">string</span> filterOutWord <span style="color:#66d9ef">in</span> filterOutLoop)
            {
                groupNameExcludeFilter.Add(filterOutWord);
            }


            <span style="color:#66d9ef">var</span> groupRecord = <span style="color:#66d9ef">from</span> x <span style="color:#66d9ef">in</span> GroupData.GroupReps.AsEnumerable()
                              <span style="color:#66d9ef">where</span> groupNameIncludeFilter.Any(f =&gt; x.Subject.ToLower().Contains(f.ToLower()))
                              &amp;&amp; groupNameExcludeFilter.Any(e =&gt; !x.Subject.ToLower().Contains(e.ToLower()))
                              <span style="color:#66d9ef">select</span> x;

            <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> groupName <span style="color:#66d9ef">in</span> groupRecord)
            {
                <span style="color:#66d9ef">try</span>
                {

                    <span style="color:#66d9ef">if</span> (!groupBeenChecked.Contains(groupName.GroupName.ToString()))
                    {
                        RemoveUserFromGroup(groupName.GroupName, activeDirOU, activeDirPath);
                        Create(activeDirOU + <span style="color:#e6db74">&#34;,&#34;</span> + activeDirPath, groupName.GroupName);
                        groupBeenChecked.Add(groupName.GroupName.ToString());
                    }
                    AddToGroup(groupName.PupADSname, groupName.GroupName, usersLocation, activeDirOU, activeDirPath);
                }
                <span style="color:#66d9ef">catch</span> (Exception e)
                {
                    Console.WriteLine(<span style="color:#e6db74">&#34;Group Name Log (&#34;</span> + e.Message.ToString() + <span style="color:#e6db74">&#34;)&#34;</span>);
                }

            }

        }


        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Create(<span style="color:#66d9ef">string</span> ouPath, <span style="color:#66d9ef">string</span> name)
        {
            <span style="color:#66d9ef">if</span> (!DirectoryEntry.Exists(<span style="color:#e6db74">&#34;LDAP://CN=&#34;</span> + name + <span style="color:#e6db74">&#34;,&#34;</span> + ouPath))
            {
                <span style="color:#66d9ef">try</span>
                {
                    <span style="color:#75715e">// bind to the container, e.g. LDAP://cn=Users,dc=...
</span><span style="color:#75715e"></span>                    DirectoryEntry entry = <span style="color:#66d9ef">new</span> DirectoryEntry(<span style="color:#e6db74">&#34;LDAP://&#34;</span> + ouPath);

                    <span style="color:#75715e">// create group entry
</span><span style="color:#75715e"></span>                    DirectoryEntry <span style="color:#66d9ef">group</span> = entry.Children.Add(<span style="color:#e6db74">&#34;CN=&#34;</span> + name, <span style="color:#e6db74">&#34;group&#34;</span>);

                    <span style="color:#75715e">// set properties
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">group</span>.Properties[<span style="color:#e6db74">&#34;sAmAccountName&#34;</span>].Value = name;

                    <span style="color:#75715e">// save group
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">group</span>.CommitChanges();
                }
                <span style="color:#66d9ef">catch</span> (Exception e)
                {
                    Console.WriteLine(<span style="color:#e6db74">&#34;Create Group Log &#34;</span> + ouPath.ToString() + <span style="color:#e6db74">&#34; - &#34;</span> + name.ToString() + <span style="color:#e6db74">&#34;(&#34;</span> + e.Message.ToString() + <span style="color:#e6db74">&#34;)&#34;</span>);
                }
            }
            <span style="color:#66d9ef">else</span> { Console.WriteLine(ouPath + <span style="color:#e6db74">&#34; already exists&#34;</span>); }
        }



        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> RemoveUserFromGroup(<span style="color:#66d9ef">string</span> groupDn, <span style="color:#66d9ef">string</span> activeDirOU, <span style="color:#66d9ef">string</span> activeDirPath)
        {
            <span style="color:#66d9ef">try</span>
            {
                List&lt;<span style="color:#66d9ef">string</span>&gt; usersInGroup = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt; { };
                DirectoryEntry dirEntry = <span style="color:#66d9ef">new</span> DirectoryEntry(<span style="color:#e6db74">&#34;LDAP://CN=&#34;</span> + groupDn + <span style="color:#e6db74">&#34;,&#34;</span> + activeDirOU + <span style="color:#e6db74">&#34;,&#34;</span> + activeDirPath);

                <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> dn <span style="color:#66d9ef">in</span> dirEntry.Properties[<span style="color:#e6db74">&#34;member&#34;</span>])
                {
                    usersInGroup.Add(dn.ToString());
                }

                <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> user <span style="color:#66d9ef">in</span> usersInGroup)
                {
                    dirEntry.Properties[<span style="color:#e6db74">&#34;member&#34;</span>].Remove(user);
                    dirEntry.CommitChanges();
                    dirEntry.Close();
                }

            }
            <span style="color:#66d9ef">catch</span> (System.DirectoryServices.DirectoryServicesCOMException e)
            {
                Console.WriteLine(<span style="color:#e6db74">&#34;Remove User Log&#34;</span> + <span style="color:#e6db74">&#34; - group probably exists elsewhere on AD (&#34;</span> + e.Message.ToString() + <span style="color:#e6db74">&#34;)&#34;</span>);
            }
        }


        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> AddToGroup(<span style="color:#66d9ef">string</span> userDn, <span style="color:#66d9ef">string</span> groupDn, <span style="color:#66d9ef">string</span> usersLocation, <span style="color:#66d9ef">string</span> activeDirOU, <span style="color:#66d9ef">string</span> activeDirPath)
        {
            <span style="color:#66d9ef">try</span>
            {
                DirectoryEntry dirEntry = <span style="color:#66d9ef">new</span> DirectoryEntry(<span style="color:#e6db74">&#34;LDAP://CN=&#34;</span> + groupDn + <span style="color:#e6db74">&#34;,&#34;</span> + activeDirOU + <span style="color:#e6db74">&#34;,&#34;</span> + activeDirPath);
                <span style="color:#66d9ef">string</span> distinguished = GetUserDn(userDn, usersLocation, activeDirPath);
                dirEntry.Properties[<span style="color:#e6db74">&#34;member&#34;</span>].Add(distinguished);
                dirEntry.CommitChanges();
                dirEntry.Close();
            }
            <span style="color:#66d9ef">catch</span> (System.DirectoryServices.DirectoryServicesCOMException e)
            {
                Console.WriteLine(<span style="color:#e6db74">&#34;Add User Log For &#34;</span> + groupDn.ToString() + <span style="color:#e6db74">&#34; - group probably exists elsewhere on AD (&#34;</span> + e.Message.ToString() + <span style="color:#e6db74">&#34;)&#34;</span>);
            }
        }


        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> GetUserDn(<span style="color:#66d9ef">string</span> identity, <span style="color:#66d9ef">string</span> usersLocation, <span style="color:#66d9ef">string</span> activeDirPath)
        {
            <span style="color:#66d9ef">using</span> (<span style="color:#66d9ef">var</span> rootEntry = <span style="color:#66d9ef">new</span> DirectoryEntry(<span style="color:#e6db74">&#34;LDAP://&#34;</span> + usersLocation + <span style="color:#e6db74">&#34;,&#34;</span> + activeDirPath, <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">null</span>, AuthenticationTypes.Secure))
            {
                <span style="color:#66d9ef">using</span> (<span style="color:#66d9ef">var</span> directorySearcher = <span style="color:#66d9ef">new</span> DirectorySearcher(rootEntry, String.Format(<span style="color:#e6db74">&#34;(sAMAccountName={0})&#34;</span>, identity)))
                {
                    <span style="color:#66d9ef">var</span> searchResult = directorySearcher.FindOne();
                    <span style="color:#66d9ef">if</span> (searchResult != <span style="color:#66d9ef">null</span>)
                    {
                        <span style="color:#66d9ef">using</span> (<span style="color:#66d9ef">var</span> userEntry = searchResult.GetDirectoryEntry())
                        {
                            <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">string</span>)userEntry.Properties[<span style="color:#e6db74">&#34;distinguishedName&#34;</span>].Value;
                        }
                    }
                }
            }
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
        }

    }
}
</code></pre></div><hr>
<h4 id="click-here-to-grab-the-standalone-ready-made-tool--appropriate-fileshttpsgithubcomnormansolutionscreateadgroupsfromschoolbasetreemasterstandaloneprogram"><a href="https://github.com/normansolutions/CreateADGroupsFromSchoolbase/tree/master/StandAloneProgram">Click here to grab the standalone, ready made tool &amp; appropriate files.</a></h4>
<hr>
<h2 id="using-the-tool">Using the tool</h2>
<p>There are three files needed to execute the process:</p>
<ul>
<li>The main executable program <em>(obviously)!</em></li>
<li>A SQL database connection string config file <em>(this is literally the details of your SQL server connection).</em></li>
<li>A batch file containing the appropriate “parameters” <em>(this includes your AD LDAP connection information and query filter information).</em></li>
</ul>
<blockquote>
<p><em>Clearly the tool will need to be run under a user account, that has full AD permissions.</em></p>
</blockquote>
<hr>


<img
src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="
data-src="/img/postimg/249a56f0-5c0c-45a2-ae72-c6d286d8c70c-min.jpg"/>


<h2 id="batch-file-explanation">Batch file explanation</h2>
<p>The real key to using this process, is understanding the parameters / switches of the batch file.</p>
<p>The batch file is fundamentally broken into 5 arguments (parameters / switches) as explained below:</p>
<ol>
<li>The first parameter is where you enter your LDAP connection: <em>e.g. &ldquo;DC=St-Stephens, DC=Local&rdquo;.</em></li>
<li>The second parameter is where you enter the Organisational Unit (OU) of where you are going to create your groups: <em>e.g. &ldquo;OU=SBGroups&rdquo;.</em></li>
<li>The third parameter is where your AD students are located: e*.g. &ldquo;OU=Students, OU=St Stephens Users&rdquo;.*</li>
<li>The forth parameter is where you can filter down, to those subjects containing a name (or names) that you wish to <strong>include</strong> in your selection; you can create multiple selections by separating each word with a “|” <em>(pipe)</em> symbol: <em>e.g. &ldquo;Art|Photo&rdquo;.</em></li>
<li>The fifth parameter is where you can filter out those subjects containing a name (or names) that you wish to <strong>exclude</strong> from your selection; again, you can create multiple selections by separating each word with a “|” <em>(pipe)</em> symbol: <em>e.g. &ldquo;UCAS|History&rdquo;.</em></li>
</ol>
<hr>
<h2 id="example">Example</h2>
<p>Below is an example batch file, that when run <em>(either manually or on a task schedule)</em> will select only those groups, where the subject name is like <strong>Art</strong> or <strong>Photo</strong> but doesn’t contain the word <strong>UCAS</strong>.</p>
<p>It would create new AD Groups within an <em>existing</em> OU called “SBGroups” on an Active Directory domain titled “St-Stephens.Local” - populating these groups with students found in an OU called “Students” under a parent OU “St Stephens Users”.</p>
<blockquote>
<p><em>Trust me – it’s a lot easier than it reads!</em></p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PowerShell" data-lang="PowerShell">C:\SCHEDULE\SBGroups\CreateADGroups.exe  <span style="color:#e6db74">&#34;DC=St-Stephens, DC=Local&#34;</span> <span style="color:#e6db74">&#34;OU=SBGroups&#34;</span> <span style="color:#e6db74">&#34;OU=Students, OU=St Stephens Users&#34;</span> <span style="color:#e6db74">&#34;Art|Photo&#34;</span> <span style="color:#e6db74">&#34;UCAS&#34;</span>
</code></pre></div><hr>
<h2 id="conclusion">Conclusion</h2>
<p>Clearly, this is just one solution to a problem, and may not fit every situation.  But under the banner of “openness and sharing” you may just find something useful in this post.</p>
<blockquote>
<p><em>It’s worth noting, that we have also experienced quite a nice side benefit from using this system, in that students and staff are much more likely to inform you of teaching group changes, when their access to network resources are involved!</em></p>
</blockquote>
<hr>
<p>The entire project is available on my <a href="https://github.com/normansolutions/CreateADGroupsFromSchoolbase">GitHub account here</a>; please fee free to download it, fork it, adjust it or completely ignore it!</p>
<p>You may also choose to compose a different query, to create different group types?</p>
<p><em>It also goes without saying, that you use any of this code, entirely at your own risk!</em></p>
 
    </div>
<button class="ns-share-btn" type="button" title="Share this article">
  <svg class="ns-share-icon">
    <use href="#share-icon"></use>
  </svg>
  <span>Share Article</span>
</button>

<svg class="ns-hidden">
  <defs>
    <symbol id="share-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></symbol> 
   </defs>
</svg>
 </main>
 
   
    <div style="height: 35px"></div>
<footer>
  <div>
    <p>Copyright (c) 2020 Normansolutions</p>
  </div>
</footer>
  
    <script>
    if('serviceWorker' in navigator) {
        navigator.serviceWorker
            .register('/sw.js', { scope: '/' })
            .then(function(registration) {
                
            });
  
        navigator.serviceWorker
            .ready
            .then(function(registration) {
                
            });
    }
  </script>
    






<script
  src="/js/bundle.min.670ec26a64469ab0048c5e977788ebbb33ef5dfab529e073c113d744e87e942d.js?v=ns-fingerprint"
  integrity="sha256-Zw7CamRGmrAEjF6Xd4jruzPvXfq1KeBzwRPXROh&#43;lC0="
  defer
  crossorigin="anonymous"
></script>

    <script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-37453744-1"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "UA-37453744-1");
</script>

    